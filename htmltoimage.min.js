(function($){var m={zip:true,zipName:'images.zip',imageNamePrefix:'image-',debug:false};var n=function(d,e,f){if(!d||!e)return null;var g=d.outerHTML;d.setAttribute('xmlns','http://www.w3.org/1999/xhtml');d.style.position='relative';$(d).inlineStyleRecursive();e.width=d.offsetWidth;e.height=d.offsetHeight;var h=e.getContext('2d');$(d).find('img').each(function(){var x=$(d).offset().left-$(this).offset().left;var y=$(d).offset().top-$(this).offset().top;var a=this.offsetWidth;var b=this.offsetHeight;var c=$(this).css('background-color')||$(this).css('background');if(c){h.fillStyle=c;h.fillRect(x,y,a,b)}h.drawImage(this,x,y,a,b);this.remove()});var i='<svg xmlns="http://www.w3.org/2000/svg" width="'+e.width+'" height="'+e.height+'">'+'<foreignObject width="100%" height="100%">'+d.outerHTML+'</foreignObject>'+'</svg>';var j=new Blob([i],{type:'image/svg+xml;charset=utf-8'});var k=(window.URL||window.webkitURL||window).createObjectURL(j);if(f){$(d).html(e)}else{d.outerHTML=g}var l=new Image();l.src=k;l.onload=function(){e.getContext('2d').drawImage(l,0,0)};return l};$.fn.convertToCanvas=function(c){c=$.extend(m,c);var d=this.length;var e=0;if(c.debug)console.log(d+' element(s) will be processed.');return this.each(function(i){if(c.debug)console.log('Processing element '+(i+1)+'.');var a=document.createElement('canvas');var b=n(this,a,true);b.onload=function(){a.getContext('2d').drawImage(b,0,0);if(c.debug)console.log(++e+' element(s) has been converted to image.')}})};$.fn.downloadAsImage=function(g){g=$.extend(m,g);var h=g.zip?new JSZip():null;var j=this.length;var k=0;if(g.debug)console.log(j+' element(s) will be processed.');return this.each(function(i){if(g.debug)console.log('Processing element '+(i+1)+'.');var d=document.createElement('canvas');var e=this.getAttribute('data-filename')||g.imageNamePrefix+(i+1)+'.png';var f=n(this,d);f.onload=function(){d.getContext('2d').drawImage(f,0,0);if(g.zip){var b=d.toDataURL();b=b.substr(b.indexOf(',')+1);h.file(e,b,{base64:true});k++;if(k==j){var c=h.generate({type:'blob'});saveAs(c,g.zipName)}}else{d.toBlob(function(a){saveAs(a,e)});k++}if(g.debug)console.log(k+' element(s) has been converted to image.')}})};$.fn.inlineStyleRecursive=function(e){return this.each(function(){if(!this)return;e=e||this;var i;var a=document.defaultView||window;var b;var c=[];if(a.getComputedStyle){b=a.getComputedStyle(this,'');for(i=0;i<b.length;i++){c.push(b[i]+':'+b.getPropertyValue(b[i]))}}else if(this.currentStyle){b=this.currentStyle;for(var d in currentStyle){c.push(d+':'+currentStyle[d])}}else{b=this.style;for(i=0;i<b.length;i++){c.push(b[i]+':'+b[b[i]])}}this.style.cssText=c.join(';');if(this!=e){this.style.top=$(e).offset().top-$(this).offset().top;this.style.left=$(e).offset().left-$(this).offset().left;this.style.position='absolute'}$(this).children().each(function(){$(this).inlineStyleRecursive(e)})})}}(jQuery));